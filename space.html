<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Space Shooter example</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
            
        }
        #wrapper {
        	margin: auto;
        	height: 600px;
        	width: 800px;
			display: block;	
        }
        
    </style>
</head>
<body>
<div id="wrapper">
</div>
<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'wrapper', { preload: preload, create: create, update: update });

function preload() {
	game.load.image('background', 'assets/starfield.jpg');
    game.load.image('player', 'assets/spaceship.png');
    game.load.image('laser', 'assets/laser.png');
}

var player;
var starfield;
var lasers;
var fireButton;
var laserTimer = 0;// the lasers come out to fast

function create() {
	//  We're going to be using physics, so enable the Arcade Physics system
    game.physics.startSystem(Phaser.Physics.ARCADE);

    // scrolling background of stars
    starfield = game.add.tileSprite(0, 0, 800, 600, 'background');
    // spaceship
    player = game.add.sprite(400, 500, 'player');
    player.scale.setTo(0.5, 0.5);
    player.anchor.setTo(0.5, 0.5);
    game.physics.enable(player, Phaser.Physics.ARCADE);
    
    // lasers
    lasers = game.add.group();
    lasers.enableBody = true;
    lasers.physicsBodyType = Phaser.Physics.ARCADE;
    lasers.createMultiple(30, 'laser');
    lasers.setAll('anchor.x', 0.5);
    lasers.setAll('anchor.y', 1);
    lasers.setAll('outOfBoundsKill', true); // kill lasers when out of bounds
    lasers.setAll('checkWorldBounds', true);
    // set up keyboard controls

    cursors = game.input.keyboard.createCursorKeys();
    fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    
}

function update() {
	starfield.tilePosition.y += 2;

    player.body.velocity.setTo(0, 0);

    if (cursors.left.isDown) {
        player.body.velocity.x = -200;
    }
    else if (cursors.right.isDown) {
        player.body.velocity.x = 200;
    }
    
    if (fireButton.isDown) {
       fireLaser();
    }

}

function fireLaser() {

    if (game.time.now > laserTimer){

        var LASER_SPEED = 200;
        var laser = lasers.getFirstExists(false);

        if (laser) { // fire a laser
            laser.reset(player.x, player.y - 16);
            laser.body.velocity.y = -400;
            laserTimer = game.time.now + LASER_SPEED;
        }
    }
    
}
</script>

</body>
</html>